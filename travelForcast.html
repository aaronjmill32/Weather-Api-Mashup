<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Weather Forecast</title>
	
	
	<style>
	#map-div{
		margin-left:100px;
		padding:30px;
		width:542px;
		height:300px;
		border:1px solid  black;

	}
	
	body{
	background-image: url("pattern.jpg");
	font-family: verdana;
	}
	
	.icons{
	font-family: MeteoconsRegular;
	
	}
	
	h1{
	text-align:center;
	font-family: cantarellbold;
	}
	
	.normalize{
	font-weight:normal;
	font-size:16px;
	text-transform: capitalize;
	}
	
	
	
	.everything{
	width: 800px;
	margin-left: auto;
	margin-right: auto;
	padding:20px;
	background-color: #99B2FF;
	}
	
	.center{
	text-align: center;
	}
	
	@font-face {
    font-family: 'MeteoconsRegular';
    src: url('meteocons-webfont.eot');
    src: url('meteocons-webfont.eot?#iefix') format('embedded-opentype'),
         url('meteocons-webfont.woff') format('woff'),
         url('meteocons-webfont.ttf') format('truetype'),
         url('meteocons-webfont.svg#MeteoconsRegular') format('svg');
    font-weight: normal;
    font-style: normal;

}

/* Generated by Font Squirrel (http://www.fontsquirrel.com) on May 4, 2015 */



@font-face {
    font-family: 'cantarellbold';
    src: url('cantarell-bold-webfont.eot');
    src: url('cantarell-bold-webfont.eot?#iefix') format('embedded-opentype'),
         url('cantarell-bold-webfont.woff2') format('woff2'),
         url('cantarell-bold-webfont.woff') format('woff'),
         url('cantarell-bold-webfont.ttf') format('truetype'),
         url('cantarell-bold-webfont.svg#cantarellbold') format('svg');
    font-weight: normal;
    font-style: normal;

}

	
	</style>
	
	
	<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdVHOpgfhIG8twUtbc31ka5xiKH3lfUMk"></script>
	<script src="http://api.wxtiles.com/wxtiles.v2.min.js" type="text/javascript" ></script>
	
	
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	
	<script>
	'use strict'
	//GLOBAL VARRIABLES
	var weatherKey = "4c03afa8a36c9bbfd81513fa90a2716a";
	var weatherURL = "http://api.openweathermap.org/data/2.5/weather?q=";
	var weatherURL2 = "http://api.openweathermap.org/data/2.5/weather?lat=";
	var map;
	var infowindow;
	var markers = [];
	
	window.onload = init;
	
	//initiate
	function init() {
	
	//set up map
	var mapOptions = {center: {lat: 39.828127, lng: -98.579404}, zoom:3};
	map = new google.maps.Map(document.getElementById('map-div'),mapOptions);
	//set up weather overlay
	 var wxoverlay=new WXTiles();
	 wxoverlay.addToMap(map);
	
	//set up each button
	document.querySelector("#search").onclick = theForecast;
	document.querySelector("#local").onclick = locate;
	
	}
	
	//HTML5 GEOLOCATION
	function locate(){
	
	if (navigator.geolocation) {	
		navigator.geolocation.getCurrentPosition(sucPoss, errorHandler);
	}
	
	}
	
	//success in finding the position
	function sucPoss(position){
	//find coords
		var lat = position.coords.latitude;
		var lng = position.coords.longitude;
		//add maker and find weather
		addMarker(lat,lng,"HERE I AM");
		var url = weatherURL2;
		url +=lat;
		url +="&lon=";
		url +=lng;
		url += "&APPID=" + weatherKey;
		console.log(url);
		$.getJSON(url).done(function(data){dataSort(data);});
		
	
	}
	
	
	//error
	function errorHandler(error){
		alert("It seems that we can't find you. Check you browser settings to allow us access to your location!");
	}
	
	function theForecast(){
	
	//parse values
	var start = document.getElementById('start').value;
	var state = document.getElementById('state').value;
	
	//trim values
	start.trim();
	state.trim();
	
	//make sure it has something in there
	if(start.length < 1) return;
	if(state.length <1) return;
	
	//encode everything
	start = encodeURI(start);
	state = encodeURI(state);
	
	//make the url stuff
	var url = weatherURL;
	url += start;
	url += ",";
	url += state;
	url += "&APPID=" + weatherKey;
	$.getJSON(url).done(function(data){dataSort(data);});
	}

	//gettinng the data and output the data
	function dataSort(obj){
	//clear markers
		clearMarkers();
		
	//get the data from the json files	
		console.log("obj = " +obj);
		console.log("obj stringified = " + JSON.stringify(obj));
		
	//if there's an error		
		if(obj.error){ 
				var message = obj.message;
				console.log("ERROR");
				return; 
			}
			
	//parse all the data
		var startCity = obj.name;
		var longitude = obj.coord.lon;
		var latitude = obj.coord.lat;
		var temp = obj.main.temp;
		temp = (temp - 273.15) *1.8 +32;
		temp = temp.toFixed(2);
		
		var humidity = obj.main.humidity;
		var pressure = obj.main.pressure;
		var weather = obj.weather[0].main;
		var des = obj.weather[0].description;
		var windSpeed = obj.wind.speed;
		var cloud = obj.clouds.all;
		var image = obj.weather[0].icon;
		
		//add marker
		addMarker(latitude,longitude, startCity);
		
		//output information
		var html = "";
		html += "<h3>Current Weather<br>" + "<img src = 'http://openweathermap.org/img/w/" + image + ".png' >"+ "<br>" + weather + "<br>" + "<span class = 'normalize'>" + des +"</span></h3>";
		
		html += "<p>Temperature: " + temp + " F<br>";
		html += "Humidity: " + humidity + "%<br>";
		html += "Pressure " + pressure + " hpa<br>";
	
		html += "Wind Speed: " + windSpeed+ " MPH</p>";
		html += "<p>Cloudy: " + cloud + "%</p>";	
		//send data out
		 document.querySelector('#content').innerHTML = html;
		
	
	
	}
	

	//add markers
		function addMarker(latitude,longitude,title){
			
			var position = {lat:latitude, lng:longitude};
			var marker = new google.maps.Marker({position: position, map:map});
			marker.setTitle(title);
			map.panTo(marker.position);
			map.setZoom(7);
			
			markers.push(marker);
		
		}
		//clear markers
		function clearMarkers(){
		
		for (var i=0;i<markers.length;i++){
			markers[i].setMap(null);
		}
		markers = [];
	
	
		}
	  
	</script>
	
</head>
<body>

<span id="tSelect"></span>
<div class = "everything">
<h1><span class = "icons">1</span> Travel Forecast <span class = "icons">1</span></h1>
<br>
<div id = "map-div"></div>
<br>
<div class = "center">
City: <input id="start" type="text" size="30" maxlength="50" value="Buffalo" autofocus /> 
State: <input id="state" type="text" size="30" maxlength="50" value="NY" autofocus /> <br>
<input type="submit" id="search"><br>
<button type="button" id="local">Weather near me!</button>

<div id = 'content'></div>
</div>
<center><a href = "../../index.html" style = "text-decoration: none; font-family: 'cantarellbold'; color: darkblue;align:center;">Return to previous page</a></center>
</div>


</body>
</html>